lab1_Pogorely_A.K.
CRUD API для пользователей, новостей и комментариев
Реализовано на FastAPI с использованием SQLAlchemy для работы с PostgreSQL и Alembic для миграций.
Описание проекта
Приложение представляет собой RESTful API для управления сущностями:

Пользователь (User)
Новость (News)
Комментарий (Comment)

Основные возможности:

Полный CRUD для всех сущностей.
Создание новостей доступно только пользователям с флагом is_author_verified = True.
Каскадное удаление: при удалении пользователя или новости удаляются связанные комментарии.
Хранение контента новости в формате JSON.
Аватарка пользователя и обложка новости — строки (URL).

Проектирование моделей
Сущности и связи

User:
id (PK)
name (str)
email (str, unique)
registration_date (datetime, auto)
is_author_verified (bool, default=False)
avatar (str, nullable)

News:
id (PK)
title (str)
content (JSON)
publication_date (datetime, auto)
author_id (FK → User.id)
cover (str, nullable)

Comment:
id (PK)
text (str)
news_id (FK → News.id)
author_id (FK → User.id)
publication_date (datetime, auto)


Связи:

User 1 → * News (автор новостей)
User 1 → * Comment (автор комментариев)
News 1 → * Comment (комментарии к новости)

Каскадное удаление реализовано через cascade="all, delete-orphan" в отношениях.
ASCII-диаграмма моделей:
textUser (id, name, email, registration_date, is_author_verified, avatar)
├── 1 --- * News (id, title, content: JSON, publication_date, author_id, cover)
│   └── 1 --- * Comment (id, text, news_id, author_id, publication_date)
└── 1 --- * Comment (id, text, news_id, author_id, publication_date)
Требования

Python 3.10+
PostgreSQL (через Docker)
Библиотеки: FastAPI, Uvicorn, SQLAlchemy, Alembic, psycopg2-binary

(см. requirements.txt)
Запуск проекта

Клонируйте репозиторий и перейдите в папку проекта.
Запустите PostgreSQL через Docker:Bashdocker-compose up -d
Примените миграции (создание таблиц + мок-данные):Bashalembic upgrade head
Запустите сервер:Bashuvicorn app.main:app --reload --host 0.0.0.0 --port 8000
Откройте документацию API:
Swagger UI: http://127.0.0.1:8000/docs
ReDoc: http://127.0.0.1:8000/redoc


Примеры использования API (curl)
Пользователи
Bash# Список пользователей
curl http://127.0.0.1:8000/users/

# Получить пользователя по ID
curl http://127.0.0.1:8000/users/1

# Создать пользователя
curl -X POST http://127.0.0.1:8000/users/ \
  -H "Content-Type: application/json" \
  -d '{"name": "New User", "email": "new@example.com", "is_author_verified": true}'

# Обновить пользователя
curl -X PUT http://127.0.0.1:8000/users/1 \
  -H "Content-Type: application/json" \
  -d '{"name": "Updated Name"}'

# Удалить пользователя
curl -X DELETE http://127.0.0.1:8000/users/1
Новости
Bash# Список новостей
curl http://127.0.0.1:8000/news/

# Создать новость (только verified author_id)
curl -X POST http://127.0.0.1:8000/news/ \
  -H "Content-Type: application/json" \
  -d '{"title": "Test News", "content": {"text": "Hello", "blocks": []}, "author_id": 1, "cover": "https://example.com/cover.jpg"}'

# Попытка создания от неverified (403)
curl -X POST http://127.0.0.1:8000/news/ \
  -H "Content-Type: application/json" \
  -d '{"title": "Forbidden", "content": {"text": "No"}, "author_id": 2}'
Комментарии
Bash# Создать комментарий
curl -X POST http://127.0.0.1:8000/comments/ \
  -H "Content-Type: application/json" \
  -d '{"text": "Great!", "news_id": 1, "author_id": 2}'
Миграции

Первая миграция создаёт таблицы users, news, comments с индексами и FK.
Вторая миграция добавляет мок-данные: 3 пользователя (1 verified), 5 новостей, несколько комментариев.

Автор: [Твоя Фамилия И. О.]
Дата: Февраль 2026
Проект выполнен в рамках курса "Web программирование".